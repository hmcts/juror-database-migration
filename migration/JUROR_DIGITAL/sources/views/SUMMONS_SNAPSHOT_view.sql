-- Generated by Ora2Pg, the Oracle database Schema converter, version 24.0
-- Copyright 2000-2023 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=172.17.0.4;sid=xe;port=1521

SET client_encoding TO 'UTF8';

SET search_path = juror_digital,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW summons_snapshot (juror_number, pool_no, service_start_date, loc_code, location_name, court_name, date_created) AS WITH ORIGINAL_SUMMONS_CTE AS (
SELECT
    PH.PART_NO AS JUROR_NUMBER,
    PH.OWNER,
    PH.POOL_NO,
    PH.DATE_PART AS DATE_CREATED,
    ROW_NUMBER() OVER(PARTITION BY PH.PART_NO ORDER BY PH.DATE_PART ASC) AS ROW_NO
FROM
    JUROR.PART_HIST PH
WHERE
	PH.HISTORY_CODE = 'RSUM'
 )

 SELECT
	OS.JUROR_NUMBER,
	OS.POOL_NO,
	UP.RETURN_DATE AS SERVICE_START_DATE,
	UP.LOC_CODE,
	CL.LOC_NAME AS LOCATION_NAME,
	CL.LOC_COURT_NAME AS COURT_NAME,
	OS.DATE_CREATED
FROM
	ORIGINAL_SUMMONS_CTE OS
INNER JOIN
	JUROR.UNIQUE_POOL UP
ON
	UP.OWNER = OS.OWNER
	AND UP.POOL_NO = OS.POOL_NO
INNER JOIN
	JUROR.COURT_LOCATION CL
ON
	UP.LOC_CODE = CL.LOC_CODE
WHERE
	OS.ROW_NO = 1;

