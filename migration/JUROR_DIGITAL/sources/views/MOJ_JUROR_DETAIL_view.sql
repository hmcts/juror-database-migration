-- Generated by Ora2Pg, the Oracle database Schema converter, version 24.0
-- Copyright 2000-2023 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=172.17.0.4;sid=xe;port=1521

SET client_encoding TO 'UTF8';

SET search_path = juror_digital,public;
\set ON_ERROR_STOP ON

CREATE OR REPLACE VIEW moj_juror_detail (part_no, pool_no, ret_date, loc_code, loc_name, loc_court_name, loc_address1, loc_address2, loc_address3, loc_address4, loc_address5, loc_address6, loc_zip, loc_attend_time, title, fname, lname, address, address2, address3, address4, address5, address6, zip, next_date, status, phone_number, alt_phone_number, dob, read_only, notes, email, last_update, new_title, new_first_name, new_last_name, new_address, new_address2, new_address3, new_address4, new_address5, new_address6, new_zip, date_received, processing_status, new_phone_number, new_alt_phone_number, new_dob, new_email, thirdparty_fname, thirdparty_lname, thirdparty_reason, thirdparty_other_reason, main_phone, other_phone, email_address, relationship, residency, residency_detail, mental_health_act, mental_health_act_details, bail, bail_details, convictions, convictions_details, deferral_reason, deferral_date, special_needs_arrangements, excusal_reason, processing_complete, completed_at, version, juror_email_details, juror_phone_details, staff_login, staff_assignment_date, urgent, super_urgent, welsh) AS WITH JUROR_DETAILS_CTE AS (
SELECT
	P.PART_NO,
    COALESCE(S.POOL_NO, P.POOL_NO) 	AS POOL_NO,
    COALESCE(S.SERVICE_START_DATE, P.RET_DATE) AS RET_DATE,
    COALESCE(S.LOC_CODE, P.LOC_CODE) AS LOC_CODE,
    P.TITLE,
    P.FNAME,
    P.LNAME,
    P.ADDRESS,
    P.ADDRESS2,
    P.ADDRESS3,
    P.ADDRESS4,
    P.ADDRESS5,
    P.ADDRESS6,
    P.ZIP,
    P.NEXT_DATE,
    P.STATUS,
    P.H_PHONE          AS PHONE_NUMBER,
    P.M_PHONE          AS ALT_PHONE_NUMBER,
    P.DOB,
    P.READ_ONLY,
    P.NOTES,
    P.H_EMAIL          AS EMAIL,
    P.LAST_UPDATE,
    R.TITLE            AS NEW_TITLE,
    R.FIRST_NAME       AS NEW_FIRST_NAME,
    R.LAST_NAME        AS NEW_LAST_NAME,
    R.ADDRESS          AS NEW_ADDRESS,
    R.ADDRESS2         AS NEW_ADDRESS2,
    R.ADDRESS3         AS NEW_ADDRESS3,
    R.ADDRESS4         AS NEW_ADDRESS4,
    R.ADDRESS5         AS NEW_ADDRESS5,
    R.ADDRESS6         AS NEW_ADDRESS6,
    R.ZIP              AS NEW_ZIP,
    R.DATE_RECEIVED,
    R.PROCESSING_STATUS,
    R.PHONE_NUMBER     AS NEW_PHONE_NUMBER,
    R.ALT_PHONE_NUMBER AS NEW_ALT_PHONE_NUMBER,
    R.DATE_OF_BIRTH    AS NEW_DOB,
    R.EMAIL            AS NEW_EMAIL,
    R.THIRDPARTY_FNAME,
    R.THIRDPARTY_LNAME,
    R.THIRDPARTY_REASON,
    R.THIRDPARTY_OTHER_REASON,
    R.MAIN_PHONE,
    R.OTHER_PHONE,
    R.EMAIL_ADDRESS,
    R.RELATIONSHIP,
    R.RESIDENCY,
    R.RESIDENCY_DETAIL,
    R.MENTAL_HEALTH_ACT,
    R.MENTAL_HEALTH_ACT_DETAILS,
    R.BAIL,
    R.BAIL_DETAILS,
    R.CONVICTIONS,
    R.CONVICTIONS_DETAILS,
    R.DEFERRAL_REASON,
    R.DEFERRAL_DATE,
    R.SPECIAL_NEEDS_ARRANGEMENTS,
    R.EXCUSAL_REASON,
    R.PROCESSING_COMPLETE,
    R.COMPLETED_AT,
    R.VERSION,
    R.JUROR_EMAIL_DETAILS,
    R.JUROR_PHONE_DETAILS,
    R.STAFF_LOGIN,
    R.STAFF_ASSIGNMENT_DATE,
    R.URGENT,
    R.SUPER_URGENT,
    R.WELSH
FROM
    JUROR.POOL P
LEFT OUTER JOIN
	JUROR_DIGITAL.JUROR_RESPONSE R
ON
	R.JUROR_NUMBER = P.PART_NO
LEFT OUTER JOIN
	JUROR_DIGITAL.SUMMONS_SNAPSHOT S
ON
	R.JUROR_NUMBER = S.JUROR_NUMBER
WHERE
    P.OWNER = '400'
    AND P.IS_ACTIVE = 'Y'
)

SELECT
	J.PART_NO,
    J.POOL_NO,
    J.RET_DATE,
    C.LOC_CODE,
    C.LOC_NAME,
    C.LOC_COURT_NAME,
    C.LOC_ADDRESS1,
    C.LOC_ADDRESS2,
    C.LOC_ADDRESS3,
    C.LOC_ADDRESS4,
    C.LOC_ADDRESS5,
    C.LOC_ADDRESS6,
    C.LOC_ZIP,
    C.LOC_ATTEND_TIME,
    J.TITLE,
    J.FNAME,
    J.LNAME,
    J.ADDRESS,
    J.ADDRESS2,
    J.ADDRESS3,
    J.ADDRESS4,
    J.ADDRESS5,
    J.ADDRESS6,
    J.ZIP,
    J.NEXT_DATE,
    J.STATUS,
    J.PHONE_NUMBER,
    J.ALT_PHONE_NUMBER,
    J.DOB,
    J.READ_ONLY,
    J.NOTES,
    J.EMAIL,
    J.LAST_UPDATE,
    J.NEW_TITLE,
    J.NEW_FIRST_NAME,
    J.NEW_LAST_NAME,
    J.NEW_ADDRESS,
    J.NEW_ADDRESS2,
    J.NEW_ADDRESS3,
    J.NEW_ADDRESS4,
    J.NEW_ADDRESS5,
    J.NEW_ADDRESS6,
    J.NEW_ZIP,
    J.DATE_RECEIVED,
    J.PROCESSING_STATUS,
    J.NEW_PHONE_NUMBER,
    J.NEW_ALT_PHONE_NUMBER,
    J.NEW_DOB,
    J.NEW_EMAIL,
    J.THIRDPARTY_FNAME,
    J.THIRDPARTY_LNAME,
    J.THIRDPARTY_REASON,
    J.THIRDPARTY_OTHER_REASON,
    J.MAIN_PHONE,
    J.OTHER_PHONE,
    J.EMAIL_ADDRESS,
    J.RELATIONSHIP,
    J.RESIDENCY,
    J.RESIDENCY_DETAIL,
    J.MENTAL_HEALTH_ACT,
    J.MENTAL_HEALTH_ACT_DETAILS,
    J.BAIL,
    J.BAIL_DETAILS,
    J.CONVICTIONS,
    J.CONVICTIONS_DETAILS,
    J.DEFERRAL_REASON,
    J.DEFERRAL_DATE,
    J.SPECIAL_NEEDS_ARRANGEMENTS,
    J.EXCUSAL_REASON,
    J.PROCESSING_COMPLETE,
    J.COMPLETED_AT,
    J.VERSION,
    J.JUROR_EMAIL_DETAILS,
    J.JUROR_PHONE_DETAILS,
    J.STAFF_LOGIN,
    J.STAFF_ASSIGNMENT_DATE,
    J.URGENT,
    J.SUPER_URGENT,
    J.WELSH
FROM
    JUROR_DETAILS_CTE J
INNER JOIN
	JUROR.COURT_LOCATION C
ON
	J.LOC_CODE = C.LOC_CODE;

