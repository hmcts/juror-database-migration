-- Generated by Ora2Pg, the Oracle database Schema converter, version 24.0
-- Copyright 2000-2023 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=172.17.0.2;sid=xe;port=1521

SET client_encoding TO 'UTF8';
SET search_path = hk,public;

  
   -----------
   --
   -----------
  


CREATE OR REPLACE PROCEDURE hk.housekeeping_nocommit_check_time_expired () AS $body$
DECLARE


     -- parameter p_max_time is the value in minutes for the maximum
     -- time the HK process should run for
   
   
BEGIN
   
      IF current_setting('housekeeping_nocommit.l_start_time')::timestamp(0) + (( 1/24/60 ) * p_max_time) > clock_timestamp() THEN
        PERFORM set_config('housekeeping_nocommit.l_time_expired', false, false);
      ELSE
        PERFORM set_config('housekeeping_nocommit.l_time_expired', true, false);
        utl_file.put_line(l_file,'*** TIME EXPIRED AT '||TO_CHAR(clock_timestamp(),'dd-mon-yyyy hh24:mi'),TRUE);
        RAISE EXCEPTION 'e_timeout' USING ERRCODE = '50004';
      END IF;

   END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hk.housekeeping_nocommit_check_time_expired () FROM PUBLIC;
